"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2573],{70230:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>h});var s=a(85893),n=a(11151);const r={},i="Write Defaults",o={id:"products/combo-gesture-expressions/additional-pages/writedefaults",title:"Write Defaults",description:"While working on ComboGestureExpressions 1.4, I had a lot of struggles with Write Defaults OFF. I have consolidated everything I've learned along the way on this page.",source:"@site/docs/products/combo-gesture-expressions/additional-pages/writedefaults.md",sourceDirName:"products/combo-gesture-expressions/additional-pages",slug:"/products/combo-gesture-expressions/additional-pages/writedefaults",permalink:"/docs/products/combo-gesture-expressions/additional-pages/writedefaults",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"V2 - Animate Transforms",permalink:"/docs/products/combo-gesture-expressions/additional-pages/v2-animate-transforms"},next:{title:"Convert to FaceEmo",permalink:"/docs/products/combo-gesture-expressions/convert-to-faceemo"}},l={},h=[{value:"Animating non-muscle transforms",id:"animating-non-muscle-transforms",level:3},{value:"Creating an Avatar Mask for the FX Layer",id:"creating-an-avatar-mask-for-the-fx-layer",level:3},{value:"Quirks",id:"quirks",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"write-defaults",children:"Write Defaults"}),"\n",(0,s.jsx)(t.p,{children:"While working on ComboGestureExpressions 1.4, I had a lot of struggles with Write Defaults OFF. I have consolidated everything I've learned along the way on this page."}),"\n",(0,s.jsxs)(t.admonition,{type:"warning",children:[(0,s.jsx)(t.p,{children:"\u26a0\ufe0f The article below was written in March 2021."}),(0,s.jsxs)(t.p,{children:["Research on this subject has evolved since then, and as of September 2023, I recommend you ",(0,s.jsx)(t.a,{href:"https://notes.sleightly.dev/write-defaults/",children:"read this other article instead"}),"."]}),(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://notes.sleightly.dev/write-defaults/",children:"https://notes.sleightly.dev/write-defaults/"})})]}),"\n",(0,s.jsx)(t.h3,{id:"animating-non-muscle-transforms",children:"Animating non-muscle transforms"}),"\n",(0,s.jsx)(t.p,{children:"Write Defaults is a tricky topic. According to the VRChat Documentation, it recommends that in general:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Write Defaults should be OFF."}),"\n",(0,s.jsx)(t.li,{children:"Transform animations belong in the Gesture Playable Layer."}),"\n",(0,s.jsx)(t.li,{children:"Muscle animations belong in the Gesture Playable Layer."}),"\n",(0,s.jsx)(t.li,{children:"Anything that is not a Transform animation nor a Muscle animation belong in the FX Playable Layer. This includes all Constraint component animation curves and GameObject toggles."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"For Transform animations to work in the Gesture Playable Layer:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["The first mask of the Gesture Playable Layer must ",(0,s.jsx)(t.em,{children:"allow"})," all Muscles and all Transforms that are animated by all the layers of the Gesture Playable Layer."]}),"\n",(0,s.jsxs)(t.li,{children:["The other masks of the Gesture Playable Layer should ",(0,s.jsx)(t.em,{children:"allow"})," only the Muscles and Transforms that are animated by the layer on which the mask is on."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["However, that is not sufficient. Transform animations in the Gesture Playable Layer will ",(0,s.jsx)(t.strong,{children:"not"})," animate if there is at least 1 layer in the FX Playable Layer that match these two conditions:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If in the FX layer, there is at least 1 layer with 1 active state having Write Defaults OFF, ",(0,s.jsx)(t.strong,{children:"and"})]}),"\n",(0,s.jsxs)(t.li,{children:["That layer has no Avatar Mask, or it has an Avatar Mask that does not ",(0,s.jsx)(t.em,{children:"deny"})," all the transforms that are being animated."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Additional notes about non-standard configurations: The above is true regardless of whether the Gesture Playable Layer uses Write Defaults OFF. Also, if a layer in the FX Playable Layer only has states with Write Defaults ON, it should not interfere so it doesn't need a mask."})}),"\n",(0,s.jsx)(t.h3,{id:"creating-an-avatar-mask-for-the-fx-layer",children:"Creating an Avatar Mask for the FX Layer"}),"\n",(0,s.jsx)(t.p,{children:"We need to create an Avatar Mask to add in the layers of the FX Playable Layer that match those two conditions. However, that Avatar Mask needs to be crafted carefully:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If a layer has animations that animates references such as Material swaps, then the Avatar Mask must ",(0,s.jsx)(t.em,{children:"allow"})," that transform in the mask. This is because the Material swap will no longer animate if it not allowed in the mask."]}),"\n",(0,s.jsxs)(t.li,{children:["In the real world, there are prefabs that animate Transforms in the FX Playable Layer. Therefore the mask must ",(0,s.jsx)(t.em,{children:"allow"})," these unusual transforms in order not to break existing prefabs."]}),"\n",(0,s.jsxs)(t.li,{children:["If there are zero transforms that need to be ",(0,s.jsx)(t.em,{children:"allowed"})," by the above rules, then the Avatar Mask must ",(0,s.jsx)(t.em,{children:"allow"})," at least 1 transform (it can be a transform that does not exist), because an Avatar Mask that has 0 transforms is considered to be ",(0,s.jsx)(t.em,{children:"allowing all"})," the transforms."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["All of the above are implemented in the Avatar mask generator provided in ",(0,s.jsx)(t.em,{children:"ComboGestureExpressions"})," by clicking ",(0,s.jsx)("span",{class:"hai-btn",children:"Add missing masks"}),"."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Please note that the default Avatar Mask editor in Unity is not flexible enough to properly build an Avatar Mask that follows the above rules, as it does not have a facility to let you insert arbitrary transforms. If you don't use the Avatar Mask generator in CGE, you may have to create it using a Debug inspector."})}),"\n",(0,s.jsx)(t.p,{children:"There is an unknown:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"According to the VRChat documentation, the mask of the first layer of the FX Playable Layer will be replaced at runtime. This means I do not know what is the expected behavior of the animator if the base layer has a strange configuration of Write Defaults OFF."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"quirks",children:"Quirks"}),"\n",(0,s.jsxs)(t.admonition,{type:"warning",children:[(0,s.jsx)(t.p,{children:"\u26a0\ufe0f The article was written in March 2021."}),(0,s.jsxs)(t.p,{children:["Research on this subject has evolved since then, and as of September 2023, I recommend you ",(0,s.jsx)(t.a,{href:"https://notes.sleightly.dev/write-defaults/",children:"read this other article instead"}),"."]}),(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://notes.sleightly.dev/write-defaults/",children:"https://notes.sleightly.dev/write-defaults/"})})]}),"\n",(0,s.jsxs)(t.p,{children:["There are additional precautions that need to be taken for Write Defaults OFF to function properly, but it is outside of the scope of ",(0,s.jsx)(t.em,{children:"ComboGestureExpressions"}),". This list may not be totally accurate:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"All transitions must have an Interruption Source set to None: This is because if a transition from A to B interrupts into a transition from A to C, which then interrupts back to a transition from A to B, it will exhibit a behavior similar to Write Defaults ON."}),"\n",(0,s.jsx)(t.li,{children:"Blend trees should not have 0 Motions."}),"\n",(0,s.jsx)(t.li,{children:"Animation clips should not have 0 animated curves."}),"\n",(0,s.jsxs)(t.li,{children:["Avoid Blend trees of type ",(0,s.jsx)(t.em,{children:"Direct"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"Even if a State is not connected to anything in the graph or is unreachable, that state will have an impact on Write Defaults ON/OFF and the behavior of your animator. Consider these unreachable states as if they were reachable."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The following are good practices that may not impact Write Defaults OFF but could be noteworthy:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["All states should have a Motion of at least 2 keyframes for safety, rather than ",(0,s.jsx)(t.code,{children:"None (Motion)"}),"."]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,t,a)=>{a.d(t,{Z:()=>o,a:()=>i});var s=a(67294);const n={},r=s.createContext(n);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);